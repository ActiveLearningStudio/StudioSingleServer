!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(0);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var i=H5P.jQuery,s=function(){function e(t,r,n,s){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},d=arguments.length>5?arguments[5]:void 0;return a(this,e),this.card=t,this.params=r||{},this.id=n,this.contentId=s,this.callbacks=o,this.parent=d,this.$cardWrapper=i("<div>",{class:"h5p-dialogcards-cardwrap",role:"group",tabindex:"-1"}),"repetition"!==this.params.mode&&this.$cardWrapper.attr("aria-labelledby","h5p-dialogcards-progress-"+H5P.Dialogcards.idCounter),this.$cardHolder=i("<div>",{class:"h5p-dialogcards-cardholder"}).appendTo(this.$cardWrapper),this.createCardContent(t).appendTo(this.$cardHolder),this}var t,r,s;return t=e,(r=[{key:"createCardContent",value:function(e){var t=i("<div>",{class:"h5p-dialogcards-card-content"});this.createCardImage(e).appendTo(t);var r=i("<div>",{class:"h5p-dialogcards-card-text-wrapper"}).appendTo(t),a=i("<div>",{class:"h5p-dialogcards-card-text-inner"}).appendTo(r),n=i("<div>",{class:"h5p-dialogcards-card-text-inner-content"}).appendTo(a);this.createCardAudio(e).appendTo(n);var s=i("<div>",{class:"h5p-dialogcards-card-text"}).appendTo(n);return this.$cardTextArea=i("<div>",{class:"h5p-dialogcards-card-text-area",tabindex:"-1",html:e.text}).appendTo(s),e.text&&e.text.length||s.addClass("hide"),this.createCardFooter().appendTo(r),t}},{key:"createCardImage",value:function(e){this.$image;var t=i("<div>",{class:"h5p-dialogcards-image-wrapper"});return void 0!==e.image?(this.image=e.image,this.$image=i('<img class="h5p-dialogcards-image" src="'+H5P.getPath(e.image.path,this.contentId)+'"/>'),e.imageAltText&&this.$image.attr("alt",e.imageAltText)):this.$image=i('<div class="h5p-dialogcards-image"></div>'),this.$image.appendTo(t),t}},{key:"createCardAudio",value:function(e){if(this.audio,this.$audioWrapper=i("<div>",{class:"h5p-dialogcards-audio-wrapper"}),void 0!==e.audio){var t={files:e.audio,audioNotSupported:this.params.audioNotSupported};this.audio=new H5P.Audio(t,this.contentId),this.audio.attach(this.$audioWrapper),this.audio.audio&&this.audio.audio.preload&&(this.audio.audio.preload="none")}else this.$audioWrapper.addClass("hide");return this.$audioWrapper}},{key:"createCardFooter",value:function(){var e=i("<div>",{class:"h5p-dialogcards-card-footer"}),t="h5p-dialogcards-button-hidden",r="-1";return"repetition"===this.params.mode&&(t="",this.params.behaviour.quickProgression&&(t="h5p-dialogcards-quick-progression",r="0")),this.$buttonTurn=H5P.JoubelUI.createButton({class:"h5p-dialogcards-turn",html:this.params.answer}).appendTo(e),this.$buttonShowSummary=H5P.JoubelUI.createButton({class:"h5p-dialogcards-show-summary h5p-dialogcards-button-gone",html:this.params.showSummary}).appendTo(e),this.$buttonIncorrect=H5P.JoubelUI.createButton({class:"h5p-dialogcards-answer-button",html:this.params.incorrectAnswer}).addClass("incorrect").addClass(t).attr("tabindex",r).appendTo(e),this.$buttonCorrect=H5P.JoubelUI.createButton({class:"h5p-dialogcards-answer-button",html:this.params.correctAnswer}).addClass("correct").addClass(t).attr("tabindex",r).appendTo(e),e}},{key:"createButtonListeners",value:function(){var e=this;this.$buttonIncorrect.unbind("click").click((function(t){t.target.classList.contains("h5p-dialogcards-quick-progression")&&e.callbacks.onNextCard({cardId:e.id,result:!1})})),this.$buttonTurn.unbind("click").click((function(){e.turnCard()})),this.$buttonCorrect.unbind("click").click((function(t){t.target.classList.contains("h5p-dialogcards-quick-progression")&&e.callbacks.onNextCard({cardId:e.id,result:!0})}))}},{key:"showSummaryButton",value:function(e){this.getDOM().find(".h5p-dialogcards-answer-button").addClass("h5p-dialogcards-button-hidden").attr("tabindex","-1"),this.$buttonTurn.addClass("h5p-dialogcards-button-gone"),this.$buttonShowSummary.click((function(){return e()})).removeClass("h5p-dialogcards-button-gone").focus()}},{key:"hideSummaryButton",value:function(){"normal"!==this.params.mode&&(this.getDOM().find(".h5p-dialogcards-answer-button").removeClass("h5p-dialogcards-button-hidden").attr("tabindex","0"),this.$buttonTurn.removeClass("h5p-dialogcards-button-gone"),this.$buttonShowSummary.addClass("h5p-dialogcards-button-gone"))}},{key:"turnCard",value:function(){var e=this,t=this.getDOM(),r=t.find(".h5p-dialogcards-card-content"),a=t.find(".h5p-dialogcards-cardholder").addClass("h5p-dialogcards-collapse");r.find(".joubel-tip-container").remove();var n=r.hasClass("h5p-dialogcards-turned");r.toggleClass("h5p-dialogcards-turned",!n),setTimeout((function(){if(a.removeClass("h5p-dialogcards-collapse"),e.changeText(n?e.getText():e.getAnswer()),n?a.find(".h5p-audio-inner").removeClass("hide"):e.removeAudio(a),"repetition"===e.params.mode&&!e.params.behaviour.quickProgression){var i=t.find(".h5p-dialogcards-answer-button");!1===i.hasClass("h5p-dialogcards-quick-progression")&&i.addClass("h5p-dialogcards-quick-progression").attr("tabindex",0)}setTimeout((function(){e.addTipToCard(r,n?"front":"back"),"function"==typeof e.callbacks.onCardTurned&&e.callbacks.onCardTurned(n,e.parent)}),200),e.resizeOverflowingText(),e.$cardTextArea.focus()}),200)}},{key:"changeText",value:function(e){this.$cardTextArea.html(e),this.$cardTextArea.toggleClass("hide",!e||!e.length)}},{key:"setProgressText",value:function(e,t){if("repetition"===this.params.mode){var r=this.params.progressText.replace("@card",e.toString()).replace("@total",t.toString());this.$cardWrapper.attr("aria-label",r)}}},{key:"resizeOverflowingText",value:function(){if(this.params.behaviour.scaleTextNotCard){var e=this.getDOM().find(".h5p-dialogcards-card-text"),t=e.children();this.resizeTextToFitContainer(e,t)}}},{key:"resizeTextToFitContainer",value:function(t,r){r.css("font-size","");var a=t.get(0).getBoundingClientRect().height,n=r.get(0).getBoundingClientRect().height,i=parseFloat(t.css("font-size")),s=parseFloat(r.css("font-size")),o=this.getDOM().closest(".h5p-container"),d=parseFloat(o.css("font-size"));if(n>a)for(var c=!0;c;){if((s-=e.SCALEINTERVAL)<e.MINSCALE){c=!1;break}r.css("font-size",s/i+"em"),(n=r.get(0).getBoundingClientRect().height)<=a&&(c=!1)}else for(var l=!0;l;){if((s+=e.SCALEINTERVAL)>d){l=!1;break}r.css("font-size",s/i+"em"),(n=r.get(0).getBoundingClientRect().height)>=a&&(l=!1,s-=e.SCALEINTERVAL,r.css("font-size",s/i+"em"))}}},{key:"addTipToCard",value:function(e,t,r){"back"!==t&&(t="front"),void 0===r&&(r=this.id),e.find(".joubel-tip-container").remove();var a=this.card.tips;if(void 0!==a&&void 0!==a[t]){var n=a[t].trim();n.length&&e.find(".h5p-dialogcards-card-text-wrapper .h5p-dialogcards-card-text-inner").after(H5P.JoubelUI.createTip(n,{tipLabel:this.params.tipButtonLabel}))}}},{key:"setCardFocus",value:function(e){if(!0===e)this.$cardTextArea.focus();else{var t=this.getDOM();t.one("transitionend",(function(){t.focus()}))}}},{key:"stopAudio",value:function(){var e=this;this.audio&&this.audio.audio&&(this.audio.audio.duration>0&&(this.audio.audio.currentTime=this.audio.audio.duration),this.audio.audio.load&&setTimeout((function(){e.audio.audio.load()}),100))}},{key:"removeAudio",value:function(){this.stopAudio(),this.getDOM().find(".h5p-audio-inner").addClass("hide")}},{key:"getDOM",value:function(){return this.$cardWrapper}},{key:"getText",value:function(){return this.card.text}},{key:"getAnswer",value:function(){return this.card.answer}},{key:"getImage",value:function(){return this.$image}},{key:"getImageSize",value:function(){return this.image?{width:this.image.width,height:this.image.height}:this.image}},{key:"getAudio",value:function(){return this.$audioWrapper}},{key:"reset",value:function(){var e=this.getDOM();e.removeClass("h5p-dialogcards-previous"),e.removeClass("h5p-dialogcards-current"),this.changeText(this.getText());var t=e.find(".h5p-dialogcards-card-content");t.removeClass("h5p-dialogcards-turned"),this.addTipToCard(t,"front",this.id),this.params.behaviour.quickProgression||e.find(".h5p-dialogcards-answer-button").removeClass("h5p-dialogcards-quick-progression"),this.hideSummaryButton()}}])&&n(t.prototype,r),s&&n(t,s),e}();s.SCALEINTERVAL=.2,s.MAXSCALE=16,s.MINSCALE=4;var o=s;function d(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var c=function(){function e(t,r,a,n){var i=this;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,this.contentId=r,this.callbacks=a,this.cards=[],this.parent=n,this.params.dialogs.forEach((function(e,t){e.id=t,i.cards.push(t)})),this}var t,r,a;return t=e,(r=[{key:"getCard",value:function(e){if(!(e<0||e>this.cards.length))return"number"==typeof this.cards[e]&&this.loadCard(e),this.cards[e]}},{key:"getCardIds",value:function(){return this.cards.map((function(e,t){return t}))}},{key:"loadCard",value:function(e){e<0||e>this.cards.length||"number"==typeof this.cards[e]&&(this.cards[e]=new o(this.params.dialogs[e],this.params,e,this.contentId,this.callbacks,this.parent))}}])&&d(t.prototype,r),a&&d(t,a),e}();function l(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return u(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return h(this,e),this.cards=t.filter((function(e,r){return t.indexOf(e)>=r})),this}var t,r,a;return t=e,(r=[{key:"getCards",value:function(){return this.cards}},{key:"peek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t=Math.max(0,t),"top"===e&&(e=0),"bottom"===e&&(e=this.cards.length-t),e<0||e>this.cards.length-1?[]:this.cards.slice(e,e+t)}},{key:"add",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top";"number"==typeof e&&(e=[e]),e.forEach((function(a){var n;-1===t.cards.indexOf(a)&&("top"===r?r=0:"bottom"===r?r=t.cards.length:"random"===r&&(r=Math.floor(Math.random()*t.cards.length)),(n=t.cards).splice.apply(n,[r,0].concat(l(e))))}))}},{key:"push",value:function(e){this.add(e,"top")}},{key:"pull",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top";return e=Math.max(1,Math.min(e,this.cards.length)),"top"===t&&(t=0),"bottom"===t&&(t=-e),t=Math.max(0,Math.min(t,this.cards.length-1)),this.cards.splice(t,e)}},{key:"remove",value:function(e){var t=this;"number"==typeof e&&(e=[e]),e.forEach((function(e){var r=t.cards.indexOf(e);r>-1&&t.cards.splice(r,1)}))}},{key:"shuffle",value:function(){for(var e=this.cards.length-1;e>0;e--){var t=Math.floor(Math.random()*(e+1)),r=[this.cards[t],this.cards[e]];this.cards[e]=r[0],this.cards[t]=r[1]}return this.cards}},{key:"contains",value:function(e){return-1!==this.cards.indexOf(e)}},{key:"length",value:function(){return this.cards.length}}])&&p(t.prototype,r),a&&p(t,a),e}();function f(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function v(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var b=function(){function e(t,r,a,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,this.cardPool=new c(t,r,a,n),this.reset(t.cardPiles),this}var t,r,a;return t=e,(r=[{key:"createSelection",value:function(){var e=[];switch(this.params.mode){case"repetition":e=this.createSelectionRepetition();break;default:e=this.cardPool.getCardIds()}return e}},{key:"createPiles",value:function(e){if(e)this.cardPiles=e.map((function(e){return new g(e.cards)}));else{this.cardPiles=[];var t=this.cardPool.getCardIds();switch(this.params.mode){case"repetition":for(var r=0;r<this.params.behaviour.maxProficiency;r++)0===r?this.cardPiles.push(new g(t)):this.cardPiles.push(new g);break;case"normal":this.cardPiles.push(new g(t))}}}},{key:"updatePiles",value:function(e){var t=this;return e.forEach((function(e){var r=t.find(e.cardId);if(-1!==r){var a=!0===e.result?r+1:0;a=Math.max(0,Math.min(a,t.cardPiles.length-1)),t.cardPiles[r].remove(e.cardId),t.cardPiles[a].add(e.cardId,"bottom")}})),this.getPileSizes()}},{key:"createSelectionRepetition",value:function(){for(var e=[],t=null,r=0;r<this.cardPiles.length-1;r++){var a,n=this.cardPiles[r].length();if(null!==t||0!==n){null===t&&(t=r);var i=Math.ceil(1*n/(1+r-t)),s=this.cardPiles[r].peek(0,i);e=(a=e).concat.apply(a,f(s))}}return e=this.shuffle(e)}},{key:"shuffle",value:function(e){for(var t=e.slice(),r=t.length-1;r>0;r--){var a=Math.floor(Math.random()*(r+1)),n=[t[a],t[r]];t[r]=n[0],t[a]=n[1]}return t}},{key:"find",value:function(e){var t=-1;return this.cardPiles.forEach((function(r,a){if(-1!==t)return t;r.contains(e)&&(t=a)})),t}},{key:"reset",value:function(e){this.createPiles(e)}},{key:"getCard",value:function(e){return this.cardPool.getCard(e)}},{key:"getSize",value:function(){return this.cardPool.getCardIds().length}},{key:"getPiles",value:function(){return this.cardPiles}},{key:"getPileSizes",value:function(){return this.cardPiles.map((function(e){return e.length()}))}}])&&v(t.prototype,r),a&&v(t,a),e}();function y(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var C=function(){function e(t,r){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.params=t,this.callbacks=r,this.currentCallback=r.nextRound,this.fields=[],this.container=document.createElement("div"),this.container.classList.add("h5p-dialogcards-summary-screen");var n=this.createContainerDOM(t.summary);this.fields.round=n.getElementsByClassName("h5p-dialogcards-summary-subheader")[0],this.fields["h5p-dialogcards-round-cards-right"]=this.addTableRow(n,{category:this.params.summaryCardsRight,symbol:"h5p-dialogcards-check"}),this.fields["h5p-dialogcards-round-cards-wrong"]=this.addTableRow(n,{category:this.params.summaryCardsWrong,symbol:"h5p-dialogcards-times"}),this.fields["h5p-dialogcards-round-cards-not-shown"]=this.addTableRow(n,{category:this.params.summaryCardsNotShown});var i=this.createContainerDOM(t.summaryOverallScore);this.fields["h5p-dialogcards-overall-cards-completed"]=this.addTableRow(i,{category:this.params.summaryCardsCompleted,symbol:"h5p-dialogcards-check"}),this.fields["h5p-dialogcards-overall-completed-rounds"]=this.addTableRow(i,{category:this.params.summaryCompletedRounds,symbol:""});var s=document.createElement("div");s.classList.add("h5p-dialogcards-summary-message"),this.fields.message=s;var o=H5P.JoubelUI.createButton({class:"h5p-dialogcards-buttonNextRound",title:this.params.nextRound.replace("@round",2),html:this.params.nextRound.replace("@round",2)}).click(this.currentCallback).get(0);this.fields.button=o;var d=H5P.JoubelUI.createButton({class:"h5p-dialogcards-button-restart",title:this.params.startOver,html:this.params.startOver}).get(0),c=this.createConfirmationDialog({l10n:this.params.confirmStartingOver,instance:this},(function(){setTimeout((function(){a.callbacks.retry()}),100)}));d.addEventListener("click",(function(e){c.show(e.target.offsetTop)})),this.fields.buttonStartOver=d;var l=document.createElement("div");return l.classList.add("h5p-dialogcards-summary-footer"),l.appendChild(d),l.appendChild(o),this.container.appendChild(n),this.container.appendChild(i),this.container.appendChild(s),this.container.appendChild(l),this.hide(),this}var t,r,a;return t=e,(r=[{key:"getDOM",value:function(){return this.container}},{key:"createContainerDOM",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=document.createElement("div");r.classList.add("h5p-dialogcards-summary-container");var a=document.createElement("div");a.classList.add("h5p-dialogcards-summary-header"),a.innerHTML=e,r.appendChild(a);var n=document.createElement("div");n.classList.add("h5p-dialogcards-summary-subheader"),n.innerHTML=t,r.appendChild(n);var i=document.createElement("table");return i.classList.add("h5p-dialogcards-summary-table"),r.appendChild(i),r}},{key:"addTableRow",value:function(e,t){var r=e.getElementsByClassName("h5p-dialogcards-summary-table")[0],a=document.createElement("tr"),n=document.createElement("td");n.classList.add("h5p-dialogcards-summary-table-row-category"),n.innerHTML=t.category,a.appendChild(n);var i=document.createElement("td");i.classList.add("h5p-dialogcards-summary-table-row-symbol"),void 0!==t.symbol&&""!==t.symbol&&i.classList.add(t.symbol),a.appendChild(i);var s=document.createElement("td");return s.classList.add("h5p-dialogcards-summary-table-row-score"),a.appendChild(s),r.appendChild(a),s}},{key:"update",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.done,a=void 0!==r&&r,n=t.round,i=void 0===n?void 0:n,s=t.message,o=void 0===s?void 0:s,d=t.results,c=void 0===d?[]:d;!0===a?(this.fields.buttonStartOver.classList.add("h5p-dialogcards-button-gone"),this.params.behaviour.enableRetry?(this.fields.button.classList.remove("h5p-dialogcards-button-next-round"),this.fields.button.classList.add("h5p-dialogcards-button-restart"),this.fields.button.innerHTML=this.params.retry,this.fields.button.title=this.params.retry,this.currentCallback=this.callbacks.retry):this.fields.button.classList.add("h5p-dialogcards-button-gone")):(this.fields.buttonStartOver.classList.remove("h5p-dialogcards-button-gone"),this.fields.button.classList.add("h5p-dialogcards-button-next-round"),this.fields.button.classList.remove("h5p-dialogcards-button-restart"),this.fields.button.innerHTML=this.params.nextRound,this.fields.button.title=this.params.nextRound,this.currentCallback=this.callbacks.nextRound),H5P.jQuery(this.fields.button).unbind("click").click(this.currentCallback),this.fields.round.innerHTML=this.params.round.replace("@round",i),a||void 0===i||(this.fields.button.innerHTML=this.params.nextRound.replace("@round",i+1),this.fields.button.title=this.params.nextRound.replace("@round",i+1)),a&&void 0!==o&&""!==o?(this.fields.message.classList.remove("h5p-dialogcards-gone"),this.fields.message.innerHTML=o):this.fields.message.classList.add("h5p-dialogcards-gone"),c.forEach((function(t){var r=void 0!==t.score.value?t.score.value:"";void 0!==t.score.max&&(r="".concat(r,'&nbsp;<span class="h5p-dialogcards-summary-table-row-score-divider">/</span>&nbsp;').concat(t.score.max)),e.fields[t.field].innerHTML=r}))}},{key:"show",value:function(){this.container.classList.remove("h5p-dialogcards-gone"),this.fields.button.focus()}},{key:"hide",value:function(){this.container.classList.add("h5p-dialogcards-gone")}},{key:"createConfirmationDialog",value:function(e,t){e=e||{};var r=new H5P.ConfirmationDialog({instance:e.instance,headerText:e.l10n.header,dialogText:e.l10n.body,cancelText:e.l10n.cancelLabel,confirmText:e.l10n.confirmLabel});return r.on("confirmed",(function(){t()})),r.appendTo(this.getContainer()),r}},{key:"getContainer",value:function(){var e=H5P.jQuery('[data-content-id="'+self.contentId+'"].h5p-content'),t=e.parents(".h5p-container");return(0!==t.length?t.last():0!==e.length?e:H5P.jQuery(document.body)).get(0)}}])&&y(t.prototype,r),a&&y(t,a),e}();function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function S(e,t){return(S=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=$(e);if(t){var n=$(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return T(this,r)}}function T(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?k(e):t}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var I=H5P.jQuery,P=H5P.JoubelUI,A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&S(e,t)}(r,H5P.EventDispatcher);var t=x(r);function r(e,a,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),r.idCounter++,(i=t.call(this)).contentId=i.id=a,i.previousState=n.previousState||{},i.contentData=n||{},i.params=I.extend({title:"",mode:"normal",description:"Sit in pairs and make up sentences where you include the expressions below.<br/>Example: I should have said yes, HOWEVER I kept my mouth shut.",next:"Next",prev:"Previous",retry:"Retry",answer:"Turn",correctAnswer:"I got it right!",incorrectAnswer:"I got it wrong",round:"Round @round",cardsLeft:"Cards left: @number",nextRound:"Proceed to round @round",startOver:"Start over",showSummary:"Next",summary:"Summary",summaryCardsRight:"Cards you got right:",summaryCardsWrong:"Cards you got wrong:",summaryCardsNotShown:"Cards in pool not shown:",summaryOverallScore:"Overall Score",summaryCardsCompleted:"Cards you have completed learning:",summaryCompletedRounds:"Completed rounds:",summaryAllDone:"Well done! You got all @cards cards correct @max times in a row each!",progressText:"Card @card of @total",cardFrontLabel:"Card front",cardBackLabel:"Card back",tipButtonLabel:"Show tip",audioNotSupported:"Your browser does not support this audio",confirmStartingOver:{header:"Start over?",body:"All progress will be lost. Are you sure you want to start over?",cancelLabel:"Cancel",confirmLabel:"Start over"},dialogs:[{text:"Horse",answer:"Hest"},{text:"Cow",answer:"Ku"}],behaviour:{enableRetry:!0,disableBackwardsNavigation:!1,scaleTextNotCard:!1,randomCards:!1,maxProficiency:5,quickProgression:!1}},e),i.cards=[],i.currentCardId=0,i.round=0,i.results=i.previousState.results||[],i.attach=function(e){i.$inner=e.addClass("h5p-dialogcards"),i.params.behaviour.scaleTextNotCard&&e.addClass("h5p-text-scaling");var t={mode:i.params.mode,dialogs:i.params.dialogs,audioNotSupported:i.params.audioNotSupported,answer:i.params.answer,showSummary:i.params.showSummary,incorrectAnswer:i.params.incorrectAnswer,correctAnswer:i.params.correctAnswer,progressText:i.params.progressText,tipButtonLabel:i.params.tipButtonLabel,behaviour:{scaleTextNotCard:i.params.behaviour.scaleTextNotCard,maxProficiency:i.params.behaviour.maxProficiency,quickProgression:i.params.behaviour.quickProgression},cardPiles:i.previousState.cardPiles};i.cardManager=new b(t,i.id,{onCardTurned:i.handleCardTurned,onNextCard:i.nextCard},k(i)),i.createDOM(0===i.round),void 0!==i.previousState.currentCardId&&(i.gotoCard(i.previousState.currentCardId),"repetition"===i.params.mode&&i.results.length===i.cardIds.length&&i.showSummary(!0)),i.updateNavigation(),i.trigger("resize")},i.createDOM=function(e){if(i.cardIds=e&&i.previousState.cardIds?i.previousState.cardIds:i.cardManager.createSelection(),i.cardPoolSize=i.cardPoolSize||i.cardManager.getSize(),!0===e){var t=I("<div>"+i.params.title+"</div>").text().trim();i.$header=I((t?'<div class="h5p-dialogcards-title"><div class="h5p-dialogcards-title-inner">'+i.params.title+"</div></div>":"")+'<div class="h5p-dialogcards-description">'+i.params.description+"</div>"),i.summaryScreen=new C(i.params,{nextRound:i.nextRound,retry:i.restartRepetition})}!0===e?i.$cardwrapperSet=i.initCards(i.cardIds):(i.$cardwrapperSet.detach(),i.$cardwrapperSet=i.initCards(i.cardIds),i.$cardSideAnnouncer.before(i.$cardwrapperSet)),i.$cardwrapperSet.prepend(i.summaryScreen.getDOM()),!0===e&&(i.$cardSideAnnouncer=I("<div>",{html:i.params.cardFrontLabel,class:"h5p-dialogcards-card-side-announcer","aria-live":"polite","aria-hidden":"true"}),i.$footer=i.createFooter(),i.$mainContent=I("<div>").append(i.$header).append(i.$cardwrapperSet).append(i.$cardSideAnnouncer).append(i.$footer).appendTo(i.$inner),i.on("reset",(function(){this.reset()})),i.on("resize",i.resize),i.round=void 0!==i.previousState.round?i.previousState.round:1)},i.createFooter=function(){var e=I("<nav>",{class:"h5p-dialogcards-footer",role:"navigation"}),t=function(e,t){I(e).append('<span class="button-tooltip">'+t+"</span>"),I(e).find(".button-tooltip").hide().fadeIn("fast")},a=function(e){I(e).find(".button-tooltip").remove()};if("normal"===i.params.mode){var n=k(i);i.$prev=P.createButton({class:"h5p-dialogcards-footer-button h5p-dialogcards-prev truncated","aria-label":i.params.prev}).click((function(){i.prevCard()})).appendTo(e),i.$prev.hover((function(e){t(n.$prev,n.params.prev)}),(function(){a(n.$prev)})),i.$next=P.createButton({class:"h5p-dialogcards-footer-button h5p-dialogcards-next truncated","aria-label":i.params.next}).click((function(){i.nextCard()})).appendTo(e),i.$next.hover((function(e){t(n.$next,n.params.next)}),(function(){a(n.$next)})),i.$retry=P.createButton({class:"h5p-dialogcards-footer-button h5p-dialogcards-retry h5p-dialogcards-disabled",html:i.params.retry}).click((function(){i.trigger("reset")})).appendTo(e),i.$progress=I("<div>",{id:"h5p-dialogcards-progress-"+r.idCounter,class:"h5p-dialogcards-progress","aria-live":"assertive"}).appendTo(e)}else i.$round=I("<div>",{class:"h5p-dialogcards-round"}).appendTo(e),i.$progress=I("<div>",{class:"h5p-dialogcards-cards-left","aria-live":"assertive"}).appendTo(e);return e},i.updateImageSize=function(){var e=0,t=i.cards[i.currentCardId].getDOM().find(".h5p-dialogcards-card-content");if(i.params.dialogs.forEach((function(r){if(r.image){var a=r.image.height/r.image.width*t.get(0).getBoundingClientRect().width;a>e&&(e=a)}})),e>0){var r=e/parseFloat(i.$inner.css("font-size"));r>15&&(r=15),i.cards.forEach((function(e){e.getImage().parent().css("height",r+"em")}))}},i.initCards=function(e){i.cards=[],i.currentCardId=0,i.params.behaviour.randomCards&&(e=H5P.shuffleArray(e));for(var t=I("<div>",{class:"h5p-dialogcards-cardwrap-set"}),r=0;r<e.length&&!(r>=2);r++){var a=i.getCard(e[r]);a.setProgressText(r+1,e.length),i.cards.push(a);var n=a.getDOM();r===i.currentCardId&&(n.addClass("h5p-dialogcards-current"),i.$current=n),a.addTipToCard(n.find(".h5p-dialogcards-card-content"),"front",r),t.append(n)}return t},i.handleCardTurned=function(e,t){var r=t.createXAPIEventTemplate("interacted");if(r.data.statement.object&&(r.data.statement.object.definition.description={"en-US":"Dialog Cards Activity"},r.data.statement.object.definition.name={"en-US":"Dialog Cards Activity"},r.data.statement.object.objectType="Activity",r.data.statement.object.id="http://adlnet.gov/expapi/activities",t.trigger(r)),i.$cardSideAnnouncer.html(e?i.params.cardFrontLabel:i.params.cardBackLabel),i.params.behaviour.enableRetry&&i.currentCardId+1===i.cardIds.length&&i.$retry){i.$retry.removeClass("h5p-dialogcards-disabled"),i.truncateRetryButton();var a=t.createXAPIEventTemplate("completed");a.data.statement.object&&(a.data.statement.object.definition.description={"en-US":"Dialog Cards Activity"},a.data.statement.object.definition.name={"en-US":"Dialog Cards Activity"},a.data.statement.object.objectType="Activity",a.data.statement.object.id="http://adlnet.gov/expapi/activities",t.trigger(a))}},i.updateNavigation=function(){if("normal"===i.params.mode)i.getCurrentSelectionIndex()<i.cardIds.length-1?(i.$next.removeClass("h5p-dialogcards-disabled"),i.$retry.addClass("h5p-dialogcards-disabled")):i.$next.addClass("h5p-dialogcards-disabled"),i.currentCardId>0&&!i.params.behaviour.disableBackwardsNavigation?i.$prev.removeClass("h5p-dialogcards-disabled"):i.$prev.addClass("h5p-dialogcards-disabled"),i.$progress.text(i.params.progressText.replace("@card",i.getCurrentSelectionIndex()+1).replace("@total",i.cardIds.length)),i.cards[i.findCardPosition(i.cards[i.currentCardId].id)].resizeOverflowingText();else{i.$round.text(i.params.round.replace("@round",i.round));var e=i.getCurrentSelectionIndex();i.$progress.text(i.params.cardsLeft.replace("@number",i.cardIds.length-e))}i.trigger("resize")},i.showSummary=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=e?i.cardManager.getPileSizes():i.cardManager.updatePiles(i.results),r=i.results.filter((function(e){return!0===e.result})).length,a=i.results.length-r,n=i.cardPoolSize-r-a,s=t.slice(-1)[0],o=s===i.cardPoolSize,d={round:i.round,results:[{field:"h5p-dialogcards-round-cards-right",score:{value:r,max:a+r}},{field:"h5p-dialogcards-round-cards-wrong",score:{value:a,max:a+r}},{field:"h5p-dialogcards-round-cards-not-shown",score:{value:n}},{field:"h5p-dialogcards-overall-cards-completed",score:{value:s,max:i.cardPoolSize}},{field:"h5p-dialogcards-overall-completed-rounds",score:{value:i.round}}]};o&&(d.done=!0,d.message=i.params.summaryAllDone.replace("@cards",i.cardPoolSize).replace("@max",i.params.behaviour.maxProficiency-1)),i.summaryScreen.update(d),i.summaryScreen.show(),i.hideCards(),i.trigger("resize")},i.showCards=function(){i.$cardwrapperSet.find(".h5p-dialogcards-cardwrap").removeClass("h5p-dialogcards-gone"),i.$footer.removeClass("h5p-dialogcards-gone"),i.cardsShown=!0},i.hideCards=function(){i.$cardwrapperSet.find(".h5p-dialogcards-cardwrap").addClass("h5p-dialogcards-gone"),i.$footer.addClass("h5p-dialogcards-gone"),i.cardsShown=!1},i.nextCard=function(e){void 0!==e&&i.results.push(e),i.cards[i.currentCardId].stopAudio(),i.cardIds.length-i.getCurrentSelectionIndex()!=1?i.gotoCard(i.getCurrentSelectionIndex()+1):"repetition"===i.params.mode&&(i.$progress.text(i.params.cardsLeft.replace("@number",0)),i.cards[i.currentCardId].showSummaryButton(i.showSummary))},i.getCard=function(e){var t=i.cardManager.getCard(e);return t.createButtonListeners(),t},i.findCardPosition=function(e){var t;return i.cards.forEach((function(r,a){t||r.id!==e||(t=a)})),t},i.insertCardToDOM=function(e,t){var r=e.getDOM();void 0===t?r.appendTo(i.$cardwrapperSet):0===t?i.$cardwrapperSet.prepend(r):i.$cardwrapperSet.children().eq(t).after(r),e.addTipToCard(r.find(".h5p-dialogcards-card-content"),"front",t)},i.gotoCard=function(e){if(!(e<0||e>=i.cardIds.length)){var t=i.cards[i.currentCardId];t.stopAudio(),t.getDOM().removeClass("h5p-dialogcards-current");var r=[];e>0&&r.push(e-1),r.push(e),e+1<i.cardIds.length&&r.push(e+1),r.forEach((function(e){if(void 0===i.findCardPosition(i.cardIds[e])){var t=i.getCard(i.cardIds[e]);t.setProgressText(e+1,i.cardIds.length);var r=Math.min(e+1,i.cardIds.length-1),a=i.findCardPosition(i.cardIds[r])||i.cards.length;i.cards.splice(a,0,t),i.insertCardToDOM(t,a)}})),i.resize(),e=i.findCardPosition(i.cardIds[e]),i.cards.forEach((function(t,r){r<e?t.getDOM().addClass("h5p-dialogcards-previous"):(t.getDOM().removeClass("h5p-dialogcards-previous"),r===e&&t.getDOM().addClass("h5p-dialogcards-current"))})),i.currentCardId=e,i.updateNavigation(),i.cards[i.currentCardId].setCardFocus()}},i.prevCard=function(){i.gotoCard(i.getCurrentSelectionIndex()-1)},i.showAllAudio=function(){i.$cardwrapperSet.find(".h5p-audio-inner").removeClass("hide")},i.restartRepetition=function(){i.cardManager.reset(),i.round=0,i.nextRound()},i.nextRound=function(){i.round++,i.summaryScreen.hide(),i.showCards(),i.reset(),i.createDOM(),i.updateNavigation(),i.cards[i.currentCardId].setCardFocus(!0),i.trigger("resize")},i.reset=function(){i.results=[],i.cards[i.currentCardId].stopAudio(i.$current.index()),i.cards.forEach((function(e){e.reset()})),i.currentCardId=0,"normal"===i.params.mode&&i.cards[i.currentCardId].getDOM().addClass("h5p-dialogcards-current"),i.updateNavigation(),i.$retry&&i.$retry.addClass("h5p-dialogcards-disabled"),i.showAllAudio(),i.cards[i.currentCardId].resizeOverflowingText(),i.cards[i.currentCardId].setCardFocus()},i.resize=function(){var e=0;i.updateImageSize(),i.params.behaviour.scaleTextNotCard||!1===i.cardsShown||i.determineCardSizes(),i.$cardwrapperSet.css("height","auto"),i.$cardwrapperSet.children(":not(.h5p-dialogcards-gone)").each((function(){var t=I(this).css("height","initial").outerHeight();if(I(this).css("height","inherit"),e=t>e?t:e,!I(this).next(".h5p-dialogcards-cardwrap").length){var r=I(this).find(".h5p-dialogcards-cardholder").css("height","initial").outerHeight();e=r>e?r:e,I(this).find(".h5p-dialogcards-cardholder").css("height","inherit")}}));var t=e/parseFloat(i.$cardwrapperSet.css("font-size"));i.$cardwrapperSet.css("height",t+"em"),i.scaleToFitHeight(),i.truncateRetryButton(),i.cards[i.currentCardId].resizeOverflowingText()},i.determineCardSizes=function(){var e=k(i);void 0===i.cardSizeDetermined&&(i.cardSizeDetermined=[]),i.$cardwrapperSet.children(":visible").each((function(t){var r=e.cards[t].id;if(-1===e.cardSizeDetermined.indexOf(r)){e.cardSizeDetermined.push(r);var a=I(".h5p-dialogcards-card-content",this),n=I(".h5p-dialogcards-card-text-inner-content",a),i=n[0].getBoundingClientRect().height,s=e.cards[t];s.changeText(s.getAnswer());var o=n[0].getBoundingClientRect().height,d=i>o?i:o,c=parseFloat(n.parent().parent().css("minHeight"));d<c&&(d=c),d/=parseFloat(a.css("fontSize")),n.parent().css("height",d+"em"),s.changeText(s.getText())}}))},i.scaleToFitHeight=function(){if(i.$cardwrapperSet&&i.$cardwrapperSet.is(":visible")&&i.params.behaviour.scaleTextNotCard)if(i.$inner.parents(".h5p-course-presentation").length){var e=i.$inner.parent();i.$inner.parents(".h5p-popup-container").length&&(e=i.$inner.parents(".h5p-popup-container"));var t=e.get(0).getBoundingClientRect().height,a=function(){var e=0;return i.$inner.children().each((function(){var t=I(this);e+=this.getBoundingClientRect().height+parseFloat(t.css("margin-top"))+parseFloat(t.css("margin-bottom"))})),e},n=a(),s=parseFloat(i.$inner.parent().css("font-size")),o=parseFloat(i.$inner.css("font-size"));if(t<n)for(;t<n&&!((o-=r.SCALEINTERVAL)<r.MINSCALE);)i.$inner.css("font-size",o/s+"em"),n=a();else for(var d=!0;d;){if((o+=r.SCALEINTERVAL)>r.MAXSCALE){d=!1;break}var c=o/s;i.$inner.css("font-size",c+"em"),t<=(n=a())&&(d=!1,c=(o-r.SCALEINTERVAL)/s,i.$inner.css("font-size",c+"em"))}}else i.cards[i.currentCardId].resizeOverflowingText()},i.truncateRetryButton=function(){if(i.$retry){i.$retry.removeClass("truncated"),i.$retry.html(i.params.retry);(i.$retry.get(0).getBoundingClientRect().width+parseFloat(i.$retry.css("margin-left"))+parseFloat(i.$retry.css("margin-right")))/i.$retry.parent().get(0).getBoundingClientRect().width>.3&&(i.$retry.addClass("truncated"),i.$retry.html(""))}},i.getCurrentSelectionIndex=function(){return i.cardIds.indexOf(i.cards[i.currentCardId].id)},i.getTitle=function(){return H5P.createTitle(i.contentData&&i.contentData.metadata&&i.contentData.metadata.title?i.contentData.metadata.title:"Dialog Cards")},i.getCurrentState=function(){if(i.cardManager)return{cardPiles:i.cardManager.getPiles(),cardIds:i.cardIds,round:i.round,currentCardId:i.getCurrentSelectionIndex(),results:i.results}},i}return r}();A.idCounter=0,A.SCALEINTERVAL=.2,A.MAXSCALE=16,A.MINSCALE=4,A.prototype=Object.create(H5P.EventDispatcher.prototype),A.prototype.constructor=A;var O=A;H5P.Dialogcards=O}]);